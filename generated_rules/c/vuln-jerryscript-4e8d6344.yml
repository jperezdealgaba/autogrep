rules:
- id: vuln-jerryscript-4e8d6344
  pattern: 'JMEM_DEFINE_LOCAL_ARRAY($ARRAY, $LENGTH * $ELEMENT_SIZE, lit_utf8_byte_t);

    lit_utf8_byte_t *$PTR = $ARRAY;

    ...

    memcpy($PTR, $BUFFER + $POS, $ELEMENT_SIZE);

    $PTR += $ELEMENT_SIZE;

    ...

    memcpy($TARGET_BUFFER, $ARRAY, $SIZE);

    '
  pattern-not: 'ecma_collection_t *$COLLECTION = ecma_new_collection();

    ...

    ecma_collection_push_back($COLLECTION, $VALUE);

    ...

    ecma_typedarray_setter_fn_t $SETTER = ecma_get_typedarray_setter_fn($INFO.id);

    ...

    $SETTER($TARGET_BUFFER + $INDEX, $COLLECTION->buffer_p[$IDX]);

    '
  languages:
  - c
  message: 'The code uses direct memory copying with `memcpy` on TypedArray buffers,
    which can lead to memory corruption or information disclosure. This is dangerous
    because it bypasses proper type checking and can result in incorrect data being
    written to memory. The fix replaces this with a type-safe approach using a collection
    and setter functions. Always use type-safe operations when working with TypedArrays.

    '
  severity: ERROR
  metadata:
    source-url: github.com/galpeter/jerryscript/commit/4e8d6344a8b5cf8f00bd3d5e869147af06d0189e
    category: security
    cwe:
    - CWE-119
    - CWE-125
    owasp:
    - 'A1: Injection'
    references:
    - https://tc39.es/ecma262/#sec-typedarray-objects
    technology:
    - c
