rules:
- id: vuln-redis-e89086e0
  pattern: 'luaL_argcheck($L, $POS+$SIZE <= $LD, $ARG, $MSG);

    '
  pattern-not: 'luaL_argcheck($L, $SIZE <= $LD && $POS <= $LD - $SIZE, $ARG, $MSG);

    '
  languages:
  - c
  message: 'This rule detects unsafe arithmetic in buffer size checks, which can lead
    to integer underflow or overflow vulnerabilities. The original code checks if
    `pos + size <= ld`, which could allow negative values for `pos` or `size` to bypass
    the check. The fix ensures that both `size` and `pos` are within valid bounds
    by checking `size <= ld` and `pos <= ld - size`. To fix this, ensure that both
    the size and position are validated separately to prevent arithmetic issues.

    '
  severity: ERROR
  metadata:
    source-url: github.com/redis/redis/commit/e89086e09a38cc6713bcd4b9c29abf92cf393936
    category: security
    cwe:
    - 'CWE-190: Integer Overflow or Wraparound'
    owasp:
    - 'A1: Injection'
    references:
    - https://cwe.mitre.org/data/definitions/190.html
    technology:
    - c
